(()=>{"use strict";function e(e,t){const o=document.elementFromPoint(e.clientX,e.clientY),{top:s}=o.getBoundingClientRect();o.classList.contains("todo-container")?e.pageY>window.scrollY+s+o.offsetHeight/2?o.closest(".todo").insertBefore(t,o.nextElementSibling):o.closest(".todo").insertBefore(t,o):o.classList.contains("todo")&&!o.querySelector(".todo-container")&&o.append(t)}const t=new class{constructor(e){this.elementList=e,this.tasks={},this.addForm=this.addForm.bind(this),this.closeForm=this.closeForm.bind(this),this.addTodo=this.addTodo.bind(this),this.deleteTodo=this.deleteTodo.bind(this),this.elementList.forEach((e=>{this.element=e,e.addEventListener("click",(e=>{let t=e.target;if(t.classList.contains("form-todo-link"))this.addForm(e);else if(t.classList.contains("form-close"))this.closeForm(e);else if(t.classList.contains("button"))this.addTodo(e);else{if(!t.classList.contains("todo-delete"))return;this.deleteTodo(e)}}))}))}addForm(e){e.preventDefault();const t=e.target.closest(".form-todo"),o=document.createElement("label"),s=document.createElement("textarea"),n=document.createElement("button"),l=document.createElement("button"),a=t.querySelector(".form-todo-link");t.prepend(o),o.appendChild(s),o.appendChild(l),o.appendChild(n),o.classList.add("label"),s.classList.add("input"),n.classList.add("button"),l.classList.add("form-close"),n.textContent="Добавить задачу",l.textContent="X",s.placeholder="Описание задачи",s.rows=5,s.maxLength=300,s.required=!0,a.style.display="none"}closeForm(e){e.preventDefault();const t=e.target.closest(".form-todo"),o=t.querySelector(".label"),s=t.querySelector(".form-todo-link");o&&(s.style.display="",o.remove())}createTodo(e){const t=document.createElement("li"),o=document.createElement("button");return t.classList.add("todo-container"),t.textContent=e,o.textContent="X",o.classList.add("todo-delete"),t.appendChild(o),t}addTodo(e){e.preventDefault();const t=e.target.closest(".column"),o=t.querySelector(".input"),s=t.querySelector(".todo");o.value&&(s.appendChild(this.createTodo(o.value)),o.value="",this.closeForm(e),this.saveTasks())}deleteTodo(e){e.preventDefault(),e.target.closest(".todo-container").remove(),this.saveTasks()}saveTasks(){let e=0;this.elementList.forEach((t=>{this.tasks[e]=[],t.querySelectorAll(".todo-container").forEach((t=>{this.tasks[e].push(t.textContent.slice(0,-1))})),e++})),localStorage.setItem("data",JSON.stringify(this.tasks))}loadTasks(){this.tasks=JSON.parse(localStorage.getItem("data"));let e=0;this.elementList.forEach((t=>{const o=t.querySelector(".todo");this.tasks[e].forEach((e=>{o.appendChild(this.createTodo(e))})),e++}))}}(document.querySelectorAll(".column"));document.addEventListener("DOMContentLoaded",(()=>{null!==JSON.parse(localStorage.getItem("data"))&&t.loadTasks()}));const o=document.querySelector(".columns");let s,n,l,a,d=null,i=null;o.addEventListener("mousedown",(e=>{if(e.target.classList.contains("todo-container")){e.preventDefault();const{top:t,left:o}=e.target.getBoundingClientRect();d=e.target,s=d.offsetWidth,n=d.offsetHeight,a=e.pageX-o,l=e.pageY-t,i=e.target.cloneNode(!0),i.innerHTML="",i.style.backgroundColor="darkgray",i.style.width=s+"px",i.style.height=n+"px",d.classList.add("dragged"),e.target.parentNode.insertBefore(i,e.target.nextElementSibling),d.style.width=s+"px",d.style.height=n+"px"}})),o.addEventListener("mouseleave",(e=>{d&&(e.preventDefault(),i.parentNode.removeChild(i),d.classList.remove("dragged"),d.style="",i=null,d=null)})),o.addEventListener("mousemove",(t=>{d&&(t.preventDefault(),e(t,i),d.style.left=t.pageX-a+"px",d.style.top=t.pageY-l+"px")})),o.addEventListener("mouseup",(o=>{d&&(e(o,d),i.parentNode.removeChild(i),d.classList.remove("dragged"),d.style="",i=null,d=null,t.saveTasks())}))})();